<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Wedding AI | Boutique</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;600;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: 'Geist', sans-serif; background: #000; color: #fff; overflow: hidden; }
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(25px);
            border-radius: 35px;
        }
        .tab-bar {
            padding-bottom: env(safe-area-inset-bottom);
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .scan-anim { animation: scan 2.5s infinite linear; }
        @keyframes scan {
            0% { top: 0%; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .img-gradient { background: linear-gradient(to bottom, transparent 60%, rgba(0,0,0,0.8)); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- CONFIGURAÇÃO DO SERVIDOR ---
        const SERVER_URL = "http://localhost/wedding"; // Ajusta para o nome da tua pasta

        const App = () => {
            const [view, setView] = useState('home');
            const [isScanning, setIsScanning] = useState(false);
            const [selectedPhoto, setSelectedPhoto] = useState(null);
            const [photos, setPhotos] = useState([]);
            
            const fileInputRef = useRef(null);
            const cameraInputRef = useRef(null);

            // Carregar fotos reais da Base de Dados
            const fetchPhotos = async () => {
                try {
                    const response = await fetch(`${SERVER_URL}/api/photos.php`);
                    const data = await response.json();
                    if (Array.isArray(data)) setPhotos(data);
                } catch (error) {
                    console.error("Erro ao carregar fotos:", error);
                }
            };

            useEffect(() => {
                fetchPhotos();
                if (window.lucide) window.lucide.createIcons();
            }, [view, isScanning, selectedPhoto]);

            // Lógica de Upload Real
            const handleFileUpload = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                setIsScanning(true);
                const formData = new FormData();
                formData.append('foto', file);

                try {
                    const response = await fetch(`${SERVER_URL}/api/upload.php`, {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();

                    if (result.success) {
                        await fetchPhotos();
                        setView('gallery');
                    } else {
                        alert(result.error || "Erro no upload");
                    }
                } catch (error) {
                    alert("Erro de conexão com o servidor local.");
                } finally {
                    setIsScanning(false);
                }
            };

            const handleUploadClick = () => fileInputRef.current?.click();
            const handleCameraClick = () => cameraInputRef.current?.click();

            const nextPhoto = () => {
                const currentIndex = photos.findIndex(p => p.id === selectedPhoto.id);
                if (currentIndex < photos.length - 1) setSelectedPhoto(photos[currentIndex + 1]);
            };

            const prevPhoto = () => {
                const currentIndex = photos.findIndex(p => p.id === selectedPhoto.id);
                if (currentIndex > 0) setSelectedPhoto(photos[currentIndex - 1]);
            };

            return (
                <div className="h-screen w-full flex flex-col relative overflow-hidden bg-black text-white">
                    
                    {/* Inputs Reais */}
                    <input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleFileUpload} />
                    <input type="file" ref={cameraInputRef} className="hidden" accept="image/*" capture="user" onChange={handleFileUpload} />

                    {/* Header */}
                    <div className="safe-top px-8 pt-8 pb-4 flex justify-between items-end bg-black/50 sticky top-0 z-30 backdrop-blur-md">
                        <div>
                            <p className="text-[10px] font-black tracking-[.3em] text-zinc-600 uppercase italic">Neural Wedding</p>
                            <h1 className="text-xl font-bold tracking-tighter">
                                {view === 'home' ? 'Protocolo' : 'Explorar'}
                            </h1>
                        </div>
                        <div className="w-10 h-10 rounded-2xl bg-zinc-900 border border-white/5 flex items-center justify-center text-[10px] font-black text-indigo-400">
                            2026
                        </div>
                    </div>

                    {/* Content */}
                    <div className="flex-1 overflow-y-auto px-6 pb-32 hide-scrollbar">
                        {view === 'home' ? (
                            <div className="space-y-6 pt-4 animate-in fade-in duration-500">
                                
                                <div 
                                    onClick={() => { setIsScanning(true); setTimeout(() => { setIsScanning(false); setView('gallery'); }, 2000); }}
                                    className="glass-card p-10 flex flex-col items-center justify-center space-y-8 border-indigo-500/20 active:scale-[0.98] transition-all cursor-pointer"
                                >
                                    <div className="relative w-20 h-20 bg-indigo-500/10 rounded-full flex items-center justify-center border border-indigo-500/20">
                                        <i data-lucide="scan" className="w-10 h-10 text-indigo-400"></i>
                                    </div>
                                    <div className="text-center">
                                        <h2 className="text-2xl font-bold italic tracking-tighter">Neural Find</h2>
                                        <p className="text-sm text-zinc-500 mt-2">O reconhecimento facial filtra as tuas fotos.</p>
                                    </div>
                                    <button className="w-full h-14 bg-white text-black rounded-3xl font-black text-xs uppercase tracking-[0.2em]">
                                        Analisar Presença
                                    </button>
                                </div>

                                <div onClick={handleUploadClick} className="glass-card p-6 flex items-center justify-between active:bg-white/5 transition-colors cursor-pointer">
                                    <div className="flex items-center gap-5">
                                        <div className="w-14 h-14 rounded-[20px] bg-white/[0.03] border border-white/10 flex items-center justify-center shadow-inner text-white">
                                            <i data-lucide="upload" className="w-6 h-6"></i>
                                        </div>
                                        <div>
                                            <h3 className="font-bold text-lg tracking-tight">Partilhar</h3>
                                            <p className="text-[10px] text-zinc-500 font-black uppercase tracking-widest">Galeria do Telefone</p>
                                        </div>
                                    </div>
                                    <div className="bg-white/5 p-2 rounded-full">
                                        <i data-lucide="chevron-right" className="w-4 h-4 text-zinc-500"></i>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="pt-4 space-y-4 animate-in fade-in">
                                <div className="flex justify-between items-center px-2">
                                    <span className="text-[10px] font-black text-zinc-500 uppercase tracking-widest">{photos.length} Fotos Encontradas</span>
                                    <button onClick={fetchPhotos} className="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Refresh</button>
                                </div>
                                
                                {photos.length === 0 ? (
                                    <div className="glass-card p-20 flex flex-col items-center opacity-20">
                                        <i data-lucide="camera-off" className="w-10 h-10 mb-4"></i>
                                        <p className="text-[10px] font-black uppercase tracking-[0.3em]">Vazio</p>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-2 gap-3">
                                        {photos.map(photo => (
                                            <div 
                                                key={photo.id} 
                                                onClick={() => setSelectedPhoto(photo)}
                                                className="aspect-[4/5] glass-card overflow-hidden border-white/5 active:scale-95 transition-transform"
                                            >
                                                <img 
                                                    src={`${SERVER_URL}/${photo.url}`} 
                                                    className="w-full h-full object-cover opacity-90" 
                                                    alt="Wedding Memory"
                                                />
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Navigation Tab Bar */}
                    <nav className="fixed bottom-0 w-full tab-bar flex justify-around items-center h-24 px-10 z-50">
                        <button onClick={() => setView('home')} className={`flex flex-col items-center gap-1.5 transition-colors ${view === 'home' ? 'text-indigo-400' : 'text-zinc-600'}`}>
                            <i data-lucide="zap" className="w-6 h-6"></i>
                            <span className="text-[9px] font-black uppercase tracking-widest">Início</span>
                        </button>
                        
                        <div className="relative -translate-y-6">
                            <div className="absolute inset-0 bg-indigo-500 blur-2xl opacity-20 animate-pulse"></div>
                            <button onClick={handleCameraClick} className="relative w-16 h-16 bg-white text-black rounded-full flex items-center justify-center shadow-2xl active:scale-90 transition-transform border-[6px] border-[#0a0a0a]">
                                <i data-lucide="camera" className="w-7 h-7"></i>
                            </button>
                        </div>

                        <button onClick={() => setView('gallery')} className={`flex flex-col items-center gap-1.5 transition-colors ${view === 'gallery' ? 'text-indigo-400' : 'text-zinc-600'}`}>
                            <i data-lucide="grid" className="w-6 h-6"></i>
                            <span className="text-[9px] font-black uppercase tracking-widest">Galeria</span>
                        </button>
                    </nav>

                    {/* Scan Overlay */}
                    {isScanning && (
                        <div className="fixed inset-0 z-[100] bg-black/95 backdrop-blur-3xl flex flex-col items-center justify-center p-10 text-center">
                            <div className="w-64 h-80 glass-card border-indigo-500/30 overflow-hidden relative mb-10">
                                <div className="scan-anim absolute w-full h-1 bg-indigo-400 shadow-[0_0_25px_#6366f1]"></div>
                                <div className="h-full flex items-center justify-center opacity-10">
                                    <i data-lucide="user-round" className="w-32 h-32 text-white"></i>
                                </div>
                            </div>
                            <h3 className="text-xs font-black tracking-[0.4em] text-indigo-400 animate-pulse uppercase">Upload Neural</h3>
                            <p className="text-zinc-500 text-sm mt-4 max-w-[200px]">A processar a tua memória nos nossos servidores...</p>
                        </div>
                    )}

                    {/* Photo Viewer Modal */}
                    {selectedPhoto && (
                        <div className="fixed inset-0 z-[110] bg-black flex flex-col animate-in fade-in zoom-in-95 duration-300">
                            <div className="safe-top p-6 flex justify-between items-center absolute top-0 w-full z-10 bg-gradient-to-b from-black/80 to-transparent">
                                <button onClick={() => setSelectedPhoto(null)} className="w-10 h-10 rounded-full bg-white/10 backdrop-blur flex items-center justify-center">
                                    <i data-lucide="x" className="w-5 h-5"></i>
                                </button>
                                <div className="text-[10px] font-black uppercase tracking-widest text-zinc-400">Visualização</div>
                                <a href={`${SERVER_URL}/${selectedPhoto.url}`} download className="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center">
                                    <i data-lucide="download" className="w-5 h-5 text-white"></i>
                                </a>
                            </div>

                            <div className="flex-1 flex items-center justify-center relative touch-none">
                                <button onClick={prevPhoto} className="absolute left-4 p-4 text-white/30 hover:text-white transition-colors">
                                    <i data-lucide="chevron-left" className="w-8 h-8"></i>
                                </button>
                                <img src={`${SERVER_URL}/${selectedPhoto.url}`} className="max-h-[70vh] w-auto object-contain shadow-2xl" />
                                <button onClick={nextPhoto} className="absolute right-4 p-4 text-white/30 hover:text-white transition-colors">
                                    <i data-lucide="chevron-right" className="w-8 h-8"></i>
                                </button>
                            </div>

                            <div className="p-8 pb-12">
                                <button onClick={() => setSelectedPhoto(null)} className="w-full h-14 glass-card rounded-2xl font-black text-xs uppercase tracking-widest">
                                    Voltar à Galeria
                                </button>
                            </div>
                        </div>
                    )}

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>